<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¯Ø±Ø¬ Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø§Ù†Ú©</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f0f0f0;
    }
    label, select, input {
      display: block;
      margin-bottom: 1em;
      width: 100%;
      max-width: 400px;
    }
    button {
      padding: 10px 20px;
      background-color: #2a9d8f;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ğŸ“¤ ÙØ±Ù… Ø«Ø¨Øª Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§</h2>

  <form id="uploadForm">
<label>Ø§Ø³ØªØ§Ù†:
  <select id="province" name="province" required>
    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
    <option>Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ</option>
    <option>Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† ØºØ±Ø¨ÛŒ</option>
    <option>Ø§Ø±Ø¯Ø¨ÛŒÙ„</option>
    <option>Ø§ØµÙÙ‡Ø§Ù†</option>
    <option>Ø§ÛŒÙ„Ø§Ù…</option>
    <option>Ø¨ÙˆØ´Ù‡Ø±</option>
    <option>ØªÙ‡Ø±Ø§Ù†</option>
    <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø¬Ù†ÙˆØ¨ÛŒ</option>
    <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ</option>
    <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø´Ù…Ø§Ù„ÛŒ</option>
    <option>Ø®ÙˆØ²Ø³ØªØ§Ù†</option>
    <option>Ø²Ù†Ø¬Ø§Ù†</option>
    <option>Ø³Ù…Ù†Ø§Ù†</option>
    <option>Ø³ÛŒØ³ØªØ§Ù† Ùˆ Ø¨Ù„ÙˆÚ†Ø³ØªØ§Ù†</option>
    <option>ÙØ§Ø±Ø³</option>
    <option>Ù‚Ø²ÙˆÛŒÙ†</option>
    <option>Ù‚Ù…</option>
    <option>Ú©Ø±Ø¯Ø³ØªØ§Ù†</option>
    <option>Ú©Ø±Ù…Ø§Ù†</option>
    <option>Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡</option>
    <option>Ú©Ù‡Ú¯ÛŒÙ„ÙˆÛŒÙ‡ Ùˆ Ø¨ÙˆÛŒØ±Ø§Ø­Ù…Ø¯</option>
    <option>Ú¯Ù„Ø³ØªØ§Ù†</option>
    <option>Ú¯ÛŒÙ„Ø§Ù†</option>
    <option>Ù„Ø±Ø³ØªØ§Ù†</option>
    <option>Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†</option>
    <option>Ù…Ø±Ú©Ø²ÛŒ</option>
    <option>Ù‡Ø±Ù…Ø²Ú¯Ø§Ù†</option>
    <option>Ù‡Ù…Ø¯Ø§Ù†</option>
    <option>ÛŒØ²Ø¯</option>
  </select>
</label>


    <label>Ø´Ù‡Ø±:
      <input type="text" id="city" required />
    </label>

    <label>Ù†ÙˆØ¹ Ø®Ø·:
      <select id="lineType" required>
        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
        <option>postpaid</option>
        <option>prepaid</option>
      </select>
    </label>

    <label>Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§ (.txt):
      <input type="file" id="fileInput" accept=".txt" required />
    </label>

    <button type="submit">ğŸ“¨ Ø«Ø¨Øª Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§</button>
  </form>

  <div id="status"></div>

  <script>
    const SUPABASE_URL = 'https://tdvimwqotnuvcdvhvbjj.supabase.co';
    const SUPABASE_API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRkdmltd3FvdG51dmNkdmh2YmpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxMDY2MjcsImV4cCI6MjA2NDY4MjYyN30.CWNPk-S-ECq0c1LRugDJYOchY3mgC2Zchyr8X8-mDeE';
    const TABLE_NAME = 'iran_mobile_whatsapp_bank';

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const province = document.getElementById("province").value;
      const city = document.getElementById("city").value;
      const lineType = document.getElementById("lineType").value;
      const file = document.getElementById("fileInput").files[0];

      if (!file) return alert("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ txt Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯");

      const text = await file.text();
      const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');

      const payload = lines.map(number => ({
        phone_number: number.trim(),
        country: 'Ø§ÛŒØ±Ø§Ù†',
        province: province,
        city: city,
        line_type: lineType,
        is_valid: true,
        is_unsubscribed: false,
        updated_at: new Date().toISOString(),
        created_at: new Date().toISOString()
      }));

      const res = await fetch(`${SUPABASE_URL}/rest/v1/${TABLE_NAME}`, {
        method: 'POST',
        headers: {
          'apikey': SUPABASE_API_KEY,
          'Authorization': `Bearer ${SUPABASE_API_KEY}`,
          'Content-Type': 'application/json',
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        document.getElementById("status").innerText = `âœ… ${payload.length} Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`;
      } else {
        const error = await res.text();
        document.getElementById("status").innerText = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª: ${error}`;
      }
    });
  </script>
</body>
</html>
