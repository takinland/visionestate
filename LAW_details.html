<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Law Details</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
</head>
<body class="bg-gray-50 font-sans text-right">

  <div class="max-w-4xl mx-auto p-6">
    <div class="flex items-center justify-between mb-4">
      <a href="LAWS.html" class="text-blue-600 underline" id="back-link">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>

      <div class="flex items-center gap-2">
        <label class="text-sm text-gray-700">Ù†Ù…Ø§ÛŒØ´:</label>
        <select id="view-mode" class="border p-1 rounded">
          <option value="html">Extracted HTML Text</option>
          <option value="translated">Translated PDF Text</option>
        </select>
      </div>
    </div>

    <div id="law-detail" class="bg-white p-6 rounded shadow text-sm leading-relaxed">
      <p class="text-gray-500">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://tdvimwqotnuvcdvhvbjj.supabase.co';
    const API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5...'; // Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª

    async function loadLawDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const lawId = urlParams.get('id');
      const lang = urlParams.get('lang') || 'en';

      const viewMode = document.getElementById('view-mode');
      const container = document.getElementById('law-detail');

      if (!lawId) {
        container.innerHTML = '<p class="text-red-500">âŒ lawId ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
        return;
      }

      try {
        console.log("ğŸ” lawId =", lawId);

        const res = await fetch(`${SUPABASE_URL}/rest/v1/laws?law_id=eq.${lawId}&select=*`, {
          headers: {
            apikey: API_KEY,
            Authorization: `Bearer ${API_KEY}`
          }
        });

        const data = await res.json();
        console.log("ğŸ“¦ laws =", data);

        if (!data.length) {
          container.innerHTML = '<p class="text-red-500">âŒ Ù‚Ø§Ù†ÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
          return;
        }

        const law = data[0];

        const langText = {
          fa: law.body_fa,
          en: law.body_en,
          ru: law.body_ru,
          tr: law.body_original
        };

        const translatedText = {
          fa: law.pdf_text_fa,
          en: law.pdf_text_en,
          ru: law.pdf_text_ru,
          tr: law.pdf_text_original
        };

        const renderContent = () => {
          const selected = viewMode.value;
          const html = selected === 'html' ? langText[lang] : translatedText[lang];

          if (!html) {
            container.innerHTML = '<p class="text-red-500">âŒ Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø²Ø¨Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
            return;
          }

          const iframe = document.createElement('iframe');
          iframe.className = 'w-full h-96 border rounded mt-4';
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          doc.open();
          doc.write(html);
          doc.close();

          container.innerHTML = '';
          container.appendChild(iframe);
        };

        viewMode.onchange = renderContent;
        renderContent();

      } catch (err) {
        console.error("âŒ Fetch error:", err);
        container.innerHTML = '<p class="text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª.</p>';
      }
    }

    window.onload = loadLawDetails;
  </script>
</body>
</html>
